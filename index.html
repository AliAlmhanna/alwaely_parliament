<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¨Ø±Ù„Ù…Ø§Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body { 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh; 
            direction: rtl;
            color: #333;
        }
        
        .login-container { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px; 
        }
        
        .login-box { 
            background: white; 
            padding: 40px; 
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            max-width: 450px; 
            width: 100%; 
            text-align: center;
            border: 3px solid rgba(59, 130, 246, 0.1);
        }
        
        .login-title { 
            font-size: 2.5rem; 
            color: #1e3a8a; 
            margin-bottom: 10px;
            font-weight: 800;
        }
        
        .login-subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }
        
        .login-options { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 30px; 
        }
        
        .login-option { 
            flex: 1; 
            padding: 20px 15px;
            border: 3px solid #e5e7eb;
            border-radius: 15px;
            cursor: pointer; 
            background: white;
            transition: all 0.3s ease;
        }
        
        .login-option:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
        }
        
        .login-option.active { 
            border-color: #3b82f6; 
            background: #dbeafe;
            transform: translateY(-2px);
        }
        
        .option-icon {
            font-size: 2rem;
            color: #1e3a8a;
            margin-bottom: 10px;
        }
        
        .option-text {
            font-weight: 700;
            color: #1e3a8a;
            font-size: 1.1rem;
        }
        
        .login-btn { 
            width: 100%; 
            padding: 18px;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white; 
            border: none; 
            border-radius: 12px; 
            margin-top: 10px; 
            cursor: pointer; 
            font-size: 1.1rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
        }
        
        .form-group { 
            margin-bottom: 25px; 
            text-align: right; 
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #1e3a8a;
            font-size: 1.1rem;
        }
        
        .form-input { 
            width: 100%; 
            padding: 16px;
            border: 3px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .main-content { 
            display: none; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .section { 
            background: white; 
            padding: 40px;
            margin-bottom: 30px; 
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid rgba(59, 130, 246, 0.1);
        }
        
        .announcement-card { 
            background: white; 
            padding: 30px;
            margin-bottom: 20px; 
            border-radius: 15px;
            border-right: 5px solid #3b82f6;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .announcement-card:hover {
            transform: translateX(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .delete-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #dc2626;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
        }
        
        .announcement-card:hover .delete-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .cloud-status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.8); 
            z-index: 2000; 
            backdrop-filter: blur(10px);
        }
        
        .modal-content { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            width: 90%; 
            max-width: 500px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            border: 3px solid rgba(59, 130, 246, 0.2);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #1e3a8a;
        }
    </style>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø© -->
    <div class="cloud-status" id="cloudStatus">
        <i class="fas fa-cloud"></i>
        <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h1 class="login-title">ğŸ›ï¸ Ø§Ù„Ø¨Ø±Ù„Ù…Ø§Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
            <p class="login-subtitle">Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙˆØ§Ø¦Ù„ÙŠ Ù„Ù„Ù…ØªÙ…ÙŠØ²ÙŠÙ†</p>
            
            <div class="loading" id="loading">
                <i class="fas fa-sync fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...
            </div>
            
            <div class="login-options">
                <div class="login-option active" onclick="selectLoginType('student')">
                    <div class="option-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="option-text">Ø·Ø§Ù„Ø¨</div>
                </div>
                <div class="login-option" onclick="selectLoginType('parliament')">
                    <div class="option-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="option-text">Ø¨Ø±Ù„Ù…Ø§Ù†ÙŠ</div>
                </div>
                <div class="login-option" onclick="selectLoginType('admin')">
                    <div class="option-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="option-text">Ù…Ø³Ø¤ÙˆÙ„</div>
                </div>
            </div>

            <div id="studentLogin">
                <button class="login-btn" onclick="loginAsStudent()">
                    <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ ÙƒØ·Ø§Ù„Ø¨
                </button>
                <p style="margin-top: 15px; color: #6b7280; font-size: 0.9rem;">
                    âœ… Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª ÙÙ‚Ø·
                </p>
            </div>

            <div id="adminLogin" style="display: none;">
                <div class="form-group">
                    <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="adminUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-input" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button class="login-btn" onclick="loginAsAdmin()">
                    <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„
                </button>
                <p style="margin-top: 15px; color: #6b7280; font-size: 0.9rem;">
                    âœ… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
                </p>
            </div>

            <div id="parliamentLogin" style="display: none;">
                <div class="form-group">
                    <label class="form-label">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-input" id="parliamentUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                </div>
                <div class="form-group">
                    <label class="form-label">ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-input" id="parliamentPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                </div>
                <button class="login-btn" onclick="loginAsParliament()">
                    <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ ÙƒØ¨Ø±Ù„Ù…Ø§Ù†ÙŠ
                </button>
                <p style="margin-top: 15px; color: #6b7280; font-size: 0.9rem;">
                    âœ… Ù†Ø´Ø± ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª
                </p>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
            <div class="section" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; text-align: center;">
                <h1 style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ›ï¸ Ø§Ù„Ø¨Ø±Ù„Ù…Ø§Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                <p style="font-size: 1.3rem; margin-bottom: 10px; opacity: 0.9;" id="welcomeMessage">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ù†ØµØ© Ø§Ù„Ø¨Ø±Ù„Ù…Ø§Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</p>
                <p style="font-size: 1.1rem; opacity: 0.8;">Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„ÙˆØ§Ø¦Ù„ÙŠ Ù„Ù„Ù…ØªÙ…ÙŠØ²ÙŠÙ† - ØµÙˆØª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆÙ‚Ø±Ø§Ø±Ù‡Ù…</p>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª -->
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #e5e7eb;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span id="userWelcome" style="font-size: 1.3rem; font-weight: 700; color: #1e3a8a;">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ </span>
                            <span id="userRole" style="background: #3b82f6; color: white; padding: 8px 20px; border-radius: 25px; font-size: 1.1rem; font-weight: 700;"></span>
                        </div>
                        <button onclick="logout()" style="background: #dc2626; color: white; border: none; padding: 12px 25px; border-radius: 12px; cursor: pointer; font-weight: 700; transition: all 0.3s ease;">
                            <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                        </button>
                    </div>

                    <div id="announcementAdminButtons" style="display: none;">
                        <button onclick="showAddAnnouncementModal()" style="background: #10b981; color: white; border: none; padding: 15px 25px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 1.1rem; transition: all 0.3s ease;">
                            <i class="fas fa-plus"></i> Ù†Ø´Ø± ØªØ¨Ù„ÙŠØº Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </div>

                <h2 style="color: #1e3a8a; margin-bottom: 25px; display: flex; align-items: center; gap: 15px; font-size: 1.8rem;">
                    <i class="fas fa-bullhorn" style="background: #dbeafe; width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;"></i>
                    ğŸ“¢ Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
                </h2>
                
                <div id="announcementsContainer">
                    <!-- Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù†Ø´Ø± ØªØ¨Ù„ÙŠØº -->
    <div class="modal" id="addAnnouncementModal">
        <div class="modal-content">
            <h3 style="text-align: center; color: #1e3a8a; margin-bottom: 30px; font-size: 1.8rem;">
                <i class="fas fa-bullhorn"></i> Ù†Ø´Ø± ØªØ¨Ù„ÙŠØº Ø¬Ø¯ÙŠØ¯
            </h3>
            <div class="form-group">
                <label class="form-label">ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¨Ù„ÙŠØº</label>
                <input type="text" class="form-input" id="announcementTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¨Ù„ÙŠØº">
            </div>
            <div class="form-group">
                <label class="form-label">ğŸ“„ ÙˆØµÙ Ø§Ù„ØªØ¨Ù„ÙŠØº</label>
                <textarea class="form-input" id="announcementDescription" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„ØªØ¨Ù„ÙŠØº" rows="6" style="width: 100%; padding: 16px; border: 3px solid #e5e7eb; border-radius: 12px; font-size: 1.1rem; resize: vertical; font-family: inherit;"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">ğŸ¯ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</label>
                <select class="form-input" id="announcementAudience" style="width: 100%; padding: 16px; border: 3px solid #e5e7eb; border-radius: 12px; font-size: 1.1rem;">
                    <option value="students">ğŸ‘¨â€ğŸ“ Ø·Ù„Ø§Ø¨ ÙÙ‚Ø·</option>
                    <option value="parliament">ğŸ‘¥ Ø¨Ø±Ù„Ù…Ø§Ù†ÙŠÙŠÙ† ÙÙ‚Ø·</option>
                    <option value="general">ğŸŒ Ø¹Ø§Ù… Ù„Ù„Ø¬Ù…ÙŠØ¹</option>
                </select>
            </div>
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <button onclick="publishAnnouncement()" style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 1.1rem; transition: all 0.3s ease;">
                    <i class="fas fa-paper-plane"></i> Ù†Ø´Ø± Ø§Ù„ØªØ¨Ù„ÙŠØº
                </button>
                <button onclick="closeModal('addAnnouncementModal')" style="background: #6b7280; color: white; border: none; padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 1.1rem; transition: all 0.3s ease;">
                    <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ğŸ”— Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase
        const SUPABASE_URL = 'https://rnzllbvsifvokvpoupue.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJuemxsYnZzaWZ2b2t2cG91cHVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0NzA1MDgsImV4cCI6MjA3OTA0NjUwOH0.Y8bTCPEpPIJ0McyPkz-czJZOYeiFjAd1xyMrWtVnaEI';
        
        // ØªÙ‡ÙŠØ¦Ø© Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let announcements = [];

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        const adminUsers = [{ username: "AliAlmhanna", password: "24012012Ali" }];
        const parliamentUsers = [];

        class CloudStorage {
            constructor() {
                this.isCloudConnected = false;
                this.testConnection();
            }

            // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase
            async testConnection() {
                try {
                    document.getElementById('loading').style.display = 'block';
                    
                    const { data, error } = await supabase
                        .from('announcements')
                        .select('*')
                        .limit(1);

                    if (error) {
                        // Ø¥Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù†Ù†Ø´Ø¦Ù‡
                        await this.createTable();
                    }

                    this.isCloudConnected = true;
                    this.showCloudStatus('âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    console.log('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase Ù†Ø§Ø¬Ø­');
                    
                    document.getElementById('loading').style.display = 'none';
                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
                    this.showCloudStatus('âš ï¸ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø­Ù„ÙŠ');
                    this.isCloudConnected = false;
                    document.getElementById('loading').style.display = 'none';
                }
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            async createTable() {
                console.log('ğŸ”¨ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„...');
                // ÙÙŠ SupabaseØŒ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ù† Dashboard ÙŠØ¯ÙˆÙŠØ§Ù‹
                // Ù„ÙƒÙ†Ù†Ø§ Ù†ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙƒÙ…Ø§ Ù„Ùˆ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            }

            // Ø¬Ù„Ø¨ Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª Ù…Ù† Supabase
            async loadAnnouncements() {
                try {
                    const { data, error } = await supabase
                        .from('announcements')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    return data || [];
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ¨Ù„ÙŠØºØ§Øª:', error);
                    // Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† localStorage
                    const localData = localStorage.getItem('announcements_backup');
                    return localData ? JSON.parse(localData) : [];
                }
            }

            // Ø­ÙØ¸ ØªØ¨Ù„ÙŠØº Ø¬Ø¯ÙŠØ¯ ÙÙŠ Supabase
            async saveAnnouncement(announcement) {
                try {
                    this.showCloudStatus('â˜ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...');

                    const { data, error } = await supabase
                        .from('announcements')
                        .insert([announcement])
                        .select();

                    if (error) throw error;

                    this.showCloudStatus('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    
                    // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ©
                    this.saveLocalBackup([...announcements, announcement]);
                    
                    return data[0];
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ¨Ù„ÙŠØº:', error);
                    this.showCloudStatus('âš ï¸ ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹');
                    
                    // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    announcement.id = Date.now(); // ID Ù…Ø¤Ù‚Øª
                    this.saveLocalBackup([...announcements, announcement]);
                    
                    return announcement;
                }
            }

            // Ø­Ø°Ù ØªØ¨Ù„ÙŠØº Ù…Ù† Supabase
            async deleteAnnouncement(id) {
                try {
                    this.showCloudStatus('â˜ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...');

                    const { error } = await supabase
                        .from('announcements')
                        .delete()
                        .eq('id', id);

                    if (error) throw error;

                    this.showCloudStatus('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©');
                    return true;
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ¨Ù„ÙŠØº:', error);
                    this.showCloudStatus('âš ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ø­Ù„ÙŠØ§Ù‹');
                    return false;
                }
            }

            // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ø­Ù„ÙŠØ©
            saveLocalBackup(data) {
                localStorage.setItem('announcements_backup', JSON.stringify(data));
            }

            // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
            showCloudStatus(message) {
                const statusElement = document.getElementById('cloudStatus');
                if (statusElement) {
                    statusElement.innerHTML = `<i class="fas fa-cloud"></i> ${message}`;
                    
                    if (message.includes('âœ…')) {
                        statusElement.style.background = '#10b981';
                    } else if (message.includes('âš ï¸')) {
                        statusElement.style.background = '#f59e0b';
                    } else {
                        statusElement.style.background = '#3b82f6';
                    }
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ instance Ù…Ù† CloudStorage
        const cloudStorage = new CloudStorage();

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
        function selectLoginType(type) {
            document.querySelectorAll('.login-option').forEach(option => {
                option.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            document.getElementById('studentLogin').style.display = type === 'student' ? 'block' : 'none';
            document.getElementById('adminLogin').style.display = type === 'admin' ? 'block' : 'none';
            document.getElementById('parliamentLogin').style.display = type === 'parliament' ? 'block' : 'none';
        }

        function loginAsStudent() {
            currentUser = { username: 'Ø·Ø§Ù„Ø¨', role: 'student' };
            showMainContent();
        }

        function loginAsAdmin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            const admin = adminUsers.find(user => user.username === username && user.password === password);
            if (admin) {
                currentUser = { username: username, role: 'admin' };
                showMainContent();
            } else {
                alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        function loginAsParliament() {
            const username = document.getElementById('parliamentUsername').value;
            const password = document.getElementById('parliamentPassword').value;
            
            const user = parliamentUsers.find(user => user.username === username && user.password === password);
            if (user) {
                currentUser = { username: username, role: 'parliament' };
                showMainContent();
            } else {
                alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

        async function showMainContent() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            document.getElementById('userWelcome').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${currentUser.username}`;
            document.getElementById('userRole').textContent = 
                currentUser.role === 'admin' ? 'Ù…Ø³Ø¤ÙˆÙ„' : 
                currentUser.role === 'parliament' ? 'Ø¨Ø±Ù„Ù…Ø§Ù†ÙŠ' : 'Ø·Ø§Ù„Ø¨';
            
            if (currentUser.role === 'admin' || currentUser.role === 'parliament') {
                document.getElementById('announcementAdminButtons').style.display = 'block';
            }
            
            await loadAnnouncements();
        }

        async function loadAnnouncements() {
            announcements = await cloudStorage.loadAnnouncements();
            displayAnnouncements();
        }

        function displayAnnouncements() {
            const container = document.getElementById('announcementsContainer');
            container.innerHTML = '';

            if (announcements.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px; color: #6b7280;">
                        <i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¨Ù„ÙŠØºØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø± ØªØ¨Ù„ÙŠØº ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>
                `;
                return;
            }

            announcements.forEach((announcement) => {
                const announcementHTML = `
                    <div class="announcement-card">
                        ${(currentUser.role === 'admin') ? 
                            `<button class="delete-btn" onclick="deleteAnnouncement(${announcement.id})">
                                <i class="fas fa-times"></i>
                            </button>` : ''}
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div style="font-weight: 800; font-size: 1.4rem; color: #1e3a8a; line-height: 1.3;">${announcement.title}</div>
                            <div style="background: #dbeafe; color: #3b82f6; padding: 6px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: 700; white-space: nowrap;">
                                ${new Date(announcement.created_at || announcement.timestamp).toLocaleDateString('ar-EG')}
                            </div>
                        </div>
                        <div style="line-height: 1.7; margin-bottom: 15px; color: #4b5563; font-size: 1.1rem;">${announcement.description}</div>
                        <div style="font-size: 0.9rem; color: #6b7280; border-top: 2px solid #f3f4f6; padding-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <span>ğŸ‘¤ Ù†Ø´Ø± Ø¨ÙˆØ§Ø³Ø·Ø©: <strong>${announcement.author || 'Ø§Ù„Ù†Ø¸Ø§Ù…'}</strong></span>
                            <span>ğŸ¯ Ù„Ù„: <strong>${getAudienceText(announcement.audience)}</strong></span>
                        </div>
                    </div>
                `;
                container.innerHTML += announcementHTML;
            });
        }

        async function publishAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const description = document.getElementById('announcementDescription').value;
            const audience = document.getElementById('announcementAudience').value;

            if (!title || !description) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            const newAnnouncement = {
                title: title,
                description: description,
                audience: audience,
                author: currentUser.username,
                created_at: new Date().toISOString()
            };

            const savedAnnouncement = await cloudStorage.saveAnnouncement(newAnnouncement);
            announcements.unshift(savedAnnouncement);
            
            displayAnnouncements();
            closeModal('addAnnouncementModal');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementDescription').value = '';
        }

        async function deleteAnnouncement(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¨Ù„ÙŠØºØŸ')) {
                const success = await cloudStorage.deleteAnnouncement(id);
                if (success) {
                    announcements = announcements.filter(announcement => announcement.id !== id);
                    displayAnnouncements();
                }
            }
        }

        function showAddAnnouncementModal() {
            document.getElementById('addAnnouncementModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('loginContainer').style.display = 'flex';
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('parliamentUsername').value = '';
            document.getElementById('parliamentPassword').value = '';
        }

        function getAudienceText(audience) {
            const audiences = {
                'students': 'Ø·Ù„Ø§Ø¨ ÙÙ‚Ø·',
                'parliament': 'Ø¨Ø±Ù„Ù…Ø§Ù†ÙŠÙŠÙ† ÙÙ‚Ø·', 
                'general': 'Ø¹Ø§Ù… Ù„Ù„Ø¬Ù…ÙŠØ¹'
            };
            return audiences[audience] || audience;
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        console.log('ğŸš€ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø±Ù„Ù…Ø§Ù† Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„');
    </script>
</body>
</html>
